
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Spa Web Admin</title>
</head>

<body>
<!-- <body onload="getElements()"> -->
    
    <div class="topItem">
        <h1>Spa Web App - Administrador</h1>
        <div class="float-right">
            <div id="nombre_usuario">Hola </div>
        </div>
    </div>

    <!-- <section class="container-items">
        <div class="item">
            <div id="serv_1" class="subItem"><span>Masajes</span></div>
            <div id="serv_2" class="subItem"><span>Depilación</span></div>
            <div id="serv_3" class="subItem"><span>Facial</span></div>
        </div>

        <div class="item formulario">

        </div>
        
    </section> -->

    <!-- <div class="container">
        <div class="row">
            <div style="border: 1px black solid" class="col-xs-6">
                ONE
            </div>
            <div class="col-xs-6">
                TWO
            </div>
        </div>
    </div> -->
    
    <!-- <div class="container">
        <div class="row">
            <div class="col">
                One of three columns
            </div>
            <div class="col">
                One of three columns
            </div>
            <div class="col">
                One of three columns
            </div>
        </div>
    </div> -->

    <div id="wrapper">
        <div class="col-2" id="first">
            <!-- Stack Overflow is for professional and enthusiast programmers, people who write code because they love it. -->
            <div id="listadoServicios" class="item">
                <!-- <div id="serv_4" onclick="showId(this)" class="subItem"><span>Masajes</span></div>
                <div id="serv_5" onclick="showId(this)" class="subItem"><span>Depilación</span></div>
                <div id="serv_6" onclick="showId(this)" class="subItem"><span>Facial</span></div> -->
                <button id="serv_1" onclick="showModules()" class="subItem serv-button" value="1"><span>Masajes</span></button>
                <!-- <button id="serv_1" onclick="showId(this)" class="subItem serv-button" value="1"><span>Masajes</span></button> -->
                <button id="serv_2" onclick="showId(this)" class="subItem serv-button" value="2"><span>Depilación</span></button>
                <button id="serv_3" onclick="showId(this)" class="subItem serv-button" value="3"><span>Facial</span></button>

                <!-- <ul id="listadoServicios">
                    <li class="subItem">Masajes</li>
                    <li class="subItem">Depilación</li>
                    <li class="subItem">Facial</li>
                </ul> -->
            </div>
            <!-- <div id="serv_4" class="subItem"><span>Masajes</span></div>
            <div id="serv_5" class="subItem"><span>Depilación</span></div>
            <div id="serv_6" class="subItem"><span>Facial</span></div> -->
        </div>
        <div class="col-10" id="second">
            <div class="container"> <div class=" text-center mt-5 ">
                <h1>Formulario de Servicios</h1>
            </div>


            <div class="row ">
                <div class="col-lg-10 mx-auto">
                    <div class="card mt-2 mx-auto p-4 bg-light">
                        <div class="card-body bg-light">
                            <div class="container">
                                <form id="formCrudServicio"  method="post">
                                    <input type="hidden" id="id" name="id" value="55">

                                    <div class="controls">
                                        <div class="row">
                                            <div class="col-md-5">
                                                <div class="form-group">
                                                    <label for="form_name">Nombre *</label>
                                                    <input id="form_name" type="text" name="nombre" value="ddd" class="form-control" placeholder="Ingrese el nombre del producto." required="required" data-error="Firstname is required.">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="form_lastname">Duración (min) *</label>
                                                    <input id="form_lastname" type="number" value="5" min="1" name="duracion" class="form-control" placeholder="" required="required" data-error="Lastname is required.">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="precio">Precio *</label>
                                                    <input type="number" id="precio" class="form-control" required name="precio" min="1" value="1" step=".01">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5">
                                                <div class="form-group">
                                                    <label for="tipo_servicio">Tipo de servicio *</label>
                                                    <select id="tipo_servicio" name="tipo_servicio" class="form-control" required data-error="Please specify your need.">
                                                        <option value="" selected disabled>-- Seleccione el tipo de servicio --</option>
                                                        <option value="1" >Normal</option>
                                                        <option value="2" >VIP</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="fotografia">Seleccionar imagen: *</label>
                                                    <!-- <input type="file" id="fotografia" name="fotografia" accept="image/*"> -->
                                                    <!-- <input type="file" id="fotografia" name="fotografia" accept="image/*,.jpg,.png" src="#"> -->
                                                    <input type="file" id="fotografia" name="fotografia" accept="image/png, image/jpg" src="#">
                                                    <img id="blah" width="100px" height="100px" src="#" alt="your image" />
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label for="descripcion">Descripción *</label>
                                                    <textarea id="descripcion" name="descripcion" class="form-control" resize="vertical"
                                                                placeholder="Escriba la descripción del servicio." rows="4"
                                                                    data-error="Please, leave us a message."></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-12 form-check">
                                                <div class="form-group">
                                                    <input type="checkbox" class="" id="estado" name="estado" value="false" >
                                                    <label class="form-check-label" for="estado">
                                                        Estado del servicio *
                                                    </label>
                                                </div>  
                                                </div>
                                            <div class="d-grid gap-2 col-6 mx-auto">
                                                <input id="guardarServicio" type="submit" class="btn btn-success btn-send pt-2 btn-block " value="Guardar Servicio">
                                            </div>
                                            <!-- <div class="d-grid gap-2 col-6 mx-auto">
                                                <button id="probarServicio" type="button" class="btn btn-success btn-send pt-2 btn-block " onclick="showModules()">Probar Servicio</button>
                                            </div> -->
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div> <!-- /.8 -->
                </div> <!-- /.row-->
            </div>
            </div>


        </div>

        </div>
    </div>



    <div class="footerItem"></div>
    

</body>
</html>

<script type="module">

// Clase export default, export objeto
    import Servicio, {lista_servicios} from '../../Componentes/Servicio/Modelo.js'
    import GenericUtils from '../../Componentes/GenericUtils/GenericUtils.js'


    // FALTA CARGAR CUANDO SE CARGA LA PANTALLA
    // DESDE LA "BASE DE DATOS" LOS ELEMENTOS EN EL MENÚ DE LOS SERVICIOS


    $('#fotografia').on('change', function () {
        const [file] = fotografia.files
        if (file) {
            blah.src = URL.createObjectURL(file);
            console.log('blah.src: ' + blah.src);
        }
    });
    



    const getFormData = () => {
        const form = document.getElementById("formCrudServicio");
        return new FormData(form);
    }

    // function submitData() {
    $('#formCrudServicio').submit(function (e) {

        e.preventDefault();
        var form = $(this);
        var url = "../../Componentes/Servicio/Modelo.js";
        
        // Obtiene el id del último elemento de la lista
        $('#id').val(parseInt(lista_servicios.at(-1).id) + 1);

        // $("<input />").attr("type", "hidden")
        //     .attr("name", "id")
        //     .attr("value", $('#id').val())
        //     .appendTo("#formCrudServicio");
        
        // addFieldToForm("id", $('#id').val(), "formCrudServicio");
        // ARREGLAR: El Id se va como String y no como Int
        // GenericUtils.addFieldToForm1("id", parseInt($('#id').val()), "formCrudServicio");

        // Gets the checkbox
        var checkBox = document.getElementById("estado");

        // addFieldToForm("estado", checkBox.checked, "#formCrudServicio");
        GenericUtils.addFieldToForm1("estado", checkBox.checked, "#formCrudServicio");
        

        
        // Convertir los datos del formulario #formCrudServicio
        // a un objeto JSON
        // Fuente: https://www.learnwithjason.dev/blog/get-form-values-as-json
        const data = new FormData(e.target);

        const jsonValue = Object.fromEntries(data.entries());
        const s = new Servicio();

        console.log({ jsonValue });
        console.log("jsonValue.nombre: " + jsonValue.nombre);
        console.log("jsonValue.tipo_servicio: " + jsonValue.tipo_servicio);
        console.log("jsonValue.precio: " + jsonValue.precio);
        console.log("typeof(jsonValue): " + typeof(jsonValue.id));
        console.log("typeof($('#id').val()): " + typeof($('#id').val()));

        console.log();

        // Genera el objeto a través del objeto JSON
        var nuevo_servicio = GenericUtils.getObjectFromJson(jsonValue, s);

        // Guarda en la "base" el objeto creado
        Servicio.saveService(nuevo_servicio);

        // Termina el guardado de datos

        // // 1era Forma
        // var formData = form.serialize();
        // var formData = JSON.stringify(form.serializeArray()); // Esta funciona
        // var formData = JSON.stringify($("#myForm").serializeArray());
        // console.log('formData: ' + formData);
        
        // // 2da Forma
        var object = {};
        const formData = getFormData();
        // // Para cada dato existente en el formData...
        formData.forEach((value, key) => 
            object[key] = value
        );

        Object.keys(object).forEach(key => formData.append(key, object[key]));
        

        var json = JSON.stringify(object);
        // var json = JSON.stringify(formData);
        
        // console.log('formData: ' + json);

        var keys = Object.keys(json);
        // console.log("JSON keys[0]: " + keys["nombre"]);

        // Read key
        for (var key in json) {
            // console.log("key: " + key);
            // console.log("json[key]: " + json[key]);
        }

        for (var key of Object.keys(json)) {
            // console.log(key + " -> " + json[key])
        }



        // // Por JavaScript
        // var idHidden = document.getElementById("id").value;
        // // Por JQuery
        // var idHidden2 = $('input#id').val();
        // var idHidden3 = $('#id').val();
        
        // console.log('idHidden: ' + idHidden);
        // console.log('idHidden2: ' + idHidden2);
        // console.log('idHidden3: ' + idHidden2);

        // // Por JavaScript - Actualiza el valor del elemento oculto con id "id"
        // // sumando 1 al último id registrado en el arreglo "servicios" de la clase Modelo.js
        // document.getElementById("id").value = servicios.at(-1).id + 1;

        // // Por JQuery - Actualiza el valor del input hidden a 49
        // $('#id').val("49");

        // console.log('#id input hidden ACTUALIZADO: ' + $('#id').val());
        

    // }

    });

    /**
     * Añade un campo al formulario que se le especifique en el parámetro formId
     */
    function addFieldToForm(name, value, formId) {

        console.log('formId: ' + formId);
        
        // Si en la 1era posición del formId no está el #...
        // if(!formId.indexOf("#", 0)) {
        if(formId.charAt(0) != "#") {
            let temp = formId;
            formId = "#" + temp;
        }

        // console.log('formId: ' + formId);

        // Añade el campo estado al formulario #formCrudServicio
        // porque cuando tiene value = false, no se incluye
        // en los datos del formulario
        // Fuente: https://stackoverflow.com/questions/17809056/how-to-add-additional-fields-to-form-before-submit
        $("<input />").attr("type", "hidden")
            .attr("name", name)
            .attr("value",value)
            // .appendTo("#formCrudServicio");
            .appendTo(formId);
    }

</script>


<script type="module">

    function showModules() {
        // var se = new Servicio();
        debugger;

        // se.push(new Servicio(7, "name2", "descripcion2", 480, "url/2.jpg", 50, "Normal", false));

        // console.log('se: ' + se);
        console.log('servicios: ' + servicios);
        
        // return false;
    }

    // import {servicios, Servicio} from "../../Componentes/Servicio/Modelo"
    import {lista_servicios} from "../../Componentes/Servicio/Modelo.js";

    // $('#probarServicio').on('click', function () {
    //     // alert("The paragraph was clicked.");

    //     var se = new Servicio();

    //     se.push(new Servicio(7, "name2", "descripcion2", 480, "url/2.jpg", 50, "Normal", false));

    //     console.log('se: ' + se);
    //     // console.log('servicios: ' + servicios);
    //     return true;
    // });

    


    var i = 0;


    function showId(e) {
        var id = e.id;
        // debugger;
        // var value = e.val();
        var value = e.value;

        console.log('id: ' + id);
        console.log('value: ' + value);


        arreglo = ["7", "8", "9", "10"];
        nombres = ["servicio 7", "servicio 8", "servicio 9", "servicio 10"]


        arreglo.forEach(element => {
            document.getElementById("listadoServicios").innerHTML += 
              "<button id=\"serv_" + i + "\"" + " onclick=\"showId(this)\" class=\"subItem serv-button\">" + nombres[i] + "</button>";
                // <button id="serv_6" onclick="showId(this)" class="subItem serv-button" value="3"><span>Facial</span></button>
                
                // document.getElementById("lista_servicios").innerHTML +=
                // `<button id="serv_${i}" onclick="${showId(this)}" class="subItem serv-button"> ${nombres[i]} </button>`;

            i++;
            
        });

    }

    

</script>
